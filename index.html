<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قبیله جنگجویان - گرافیک بالا</title>
        <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Tahoma, Arial, sans-serif;
            background: #000;
        }
                  #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
                  }
                  #uiOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
                  }
                  .tribePanel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #8B4513;
            pointer-events: auto;
                  }
                  .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            pointer-events: auto;
                  }
                  button {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #A0522D;
            transform: translateY(-2px);
        }
        </style>
   </head>
  <body>
    <div id="gameContainer">
        <canvas id="renderCanvas"></canvas>              
                <div class="controls">
                <button kl="addWarrior">آموزش جنگجو</button>
                <button kl="buildHut">ساخت کلبه</button>
                <button kl="zoomIn">بزرگنمایی</button>
                <button kl="zoomOut">کوچکنمایی</button>
                <button kl="moveCamera">حرکت دوربین</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="js/gameConfig.js"></script>
    <script src="js/tribeManager.js"></script>
    <script src="js/terrainManager.js"></script>
    <script src="js/cameraController.js"></script>
    <script src="js/main.js"></script>
    // خط 1: تنظیمات اصلی بازی
    const GameConfig = {
    // خط 2: تنظیمات گرافیکی
    graphics: {
        enableShadows: true,
        enablePostProcess: true,
        textureQuality: "high",
        waterReflection: true
    },
    
    // خط 3: تنظیمات دنیای بازی
    world: {
        size: 2000,
        terrainSegments: 100,
        waterLevel: 5
    },
    
    // خط 4: تنظیمات منابع
    resources: {
        startingFood: 1000,
        startingWood: 500,
        startingStone: 300,
        startingPopulation: 10
    },
    
    // خط 5: تنظیمات قبیله
    tribe: {
        maxPopulation: 100,
        warriorCost: 50,
        hutCost: {
            wood: 100,
            stone: 80
        }
    }
};

// خط 6: رنگ‌های قبیله‌ها
const TribeColors = {
    player: "#8B4513",    // قهوه‌ای
    enemy1: "#FF6B6B",    // قرمز
    enemy2: "#4ECDC4",    // فیروزه‌ای
    enemy3: "#45B7D1"     // آبی
};

// خط 7: انواع ساختمان‌ها
const BuildingTypes = {
    HUT: "hut",
    BARRACKS: "barracks",
    STORAGE: "storage",
    TEMPLE: "temple"
};

// خط 8: انواع واحدها
const UnitTypes = {
    WARRIOR: "warrior",
    HUNTER: "hunter",
    WORKER: "worker",
    SHAMAN: "shaman"
};

// خط 9: صادر کردن تنظیمات برای استفاده در فایل‌های دیگر
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { GameConfig, TribeColors, BuildingTypes, UnitTypes };
}
      // خط 1: کلاس مدیریت زمین بازی
class TerrainManager {
    // خط 2: سازنده کلاس
    constructor(scene) {
        this.scene = scene;
        this.ground = null;
        this.water = null;
        this.trees = [];
        this.rocks = [];
        this.groundMaterial = null;
        
        // خط 3: ایجاد زمین
        this.createGround();
        
        // خط 4: ایجاد آب
        this.createWater();
        
        // خط 5: ایجاد درختان و صخره‌ها
        this.generateVegetation();
        this.generateRocks();
        
        // خط 6: تنظیم نورپردازی محیط
        this.setupLighting();
    }
    
    // خط 7: تابع ایجاد زمین
    createGround() {
        // خط 8: ایجاد mesh زمین
        this.ground = BABYLON.MeshBuilder.CreateGround("ground", {
            width: GameConfig.world.size,
            height: GameConfig.world.size,
            subdivisions: GameConfig.world.terrainSegments
        }, this.scene);
        
        // خط 9: ایجاد متریال پیشرفته برای زمین
        this.groundMaterial = new BABYLON.StandardMaterial("groundMaterial", this.scene);
        this.groundMaterial.diffuseTexture = new BABYLON.Texture("https://i.imgur.com/8Y4Jq7M.jpg", this.scene);
        this.groundMaterial.diffuseTexture.uScale = 20;
        this.groundMaterial.diffuseTexture.vScale = 20;
        
        // خط 10: اضافه کردن نرمال مپ برای جزئیات بیشتر
        this.groundMaterial.bumpTexture = new BABYLON.Texture("https://i.imgur.com/6Q0M2y2.jpg", this.scene);
        this.groundMaterial.bumpTexture.uScale = 20;
        this.groundMaterial.bumpTexture.vScale = 20;
        
        // خط 11: اضافه کردن مپ انعکاس
        this.groundMaterial.specularTexture = new BABYLON.Texture("https://i.imgur.com/3JQ1Y2q.jpg", this.scene);
        this.groundMaterial.specularPower = 64;
        
        this.ground.material = this.groundMaterial;
        
        // خط 12: دریافت ارتفاع‌های مختلف برای زمین
        this.createHeightVariation();
    }
    
    // خط 13: تابع ایجاد تغییرات ارتفاع زمین
    createHeightVariation() {
        // خط 14: ایجاد نویز برای زمین ناهموار
        const noiseTexture = new BABYLON.NoiseProceduralTexture("noise", 256, this.scene);
        noiseTexture.octaves = 4;
        noiseTexture.persistence = 0.8;
        
        // خط 15: اعمال تغییرات ارتفاع به زمین
        const positions = this.ground.getVerticesData(BABYLON.VertexBuffer.PositionKind);
        for (let i = 0; i < positions.length; i += 3) {
            const x = positions[i];
            const z = positions[i + 2];
            
            // خط 16: محاسبه ارتفاع بر اساس نویز
            const height = noiseTexture.getValue(x * 0.01, z * 0.01) * 20;
            positions[i + 1] = height;
        }
        
        // خط 17: به روزرسانی mesh زمین
        this.ground.updateVerticesData(BABYLON.VertexBuffer.PositionKind, positions);
    }
    
    // خط 18: تابع ایجاد آب
    createWater() {
        // خط 19: ایجاد mesh آب
        this.water = BABYLON.MeshBuilder.CreateGround("water", {
            width: GameConfig.world.size,
            height: GameConfig.world.size
        }, this.scene);
        
        // خط 20: ایجاد متریال آب پیشرفته
        const waterMaterial = new BABYLON.WaterMaterial("waterMaterial", this.scene);
        waterMaterial.bumpTexture = new BABYLON.Texture("https://i.imgur.com/6Q0M2y2.jpg", this.scene);
        waterMaterial.windForce = -5;
        waterMaterial.waveHeight = 0.5;
        waterMaterial.bumpHeight = 0.5;
        waterMaterial.waveLength = 0.1;
        waterMaterial.windDirection = new BABYLON.Vector2(1, 1);
        waterMaterial.waterColor = new BABYLON.Color3(0.1, 0.1, 0.6);
        waterMaterial.colorBlendFactor = 0.3;
        
        this.water.material = waterMaterial;
        this.water.position.y = GameConfig.world.waterLevel;
    }
    
    // خط 21: تابع ایجاد پوشش گیاهی
    generateVegetation() {
        // خط 22: ایجاد 50 درخت در موقعیت‌های تصادفی
        for (let i = 0; i < 50; i++) {
            this.createTree(
                Math.random() * GameConfig.world.size - GameConfig.world.size / 2,
                0,
                Math.random() * GameConfig.world.size - GameConfig.world.size / 2
            );
        }
    }
    
    // خط 23: تابع ایجاد یک درخت
    createTree(x, y, z) {
        // خط 24: ایجاد تنه درخت
        const trunk = BABYLON.MeshBuilder.CreateCylinder("trunk", {
            height: 8,
            diameter: 1
        }, this.scene);
        
        // خط 25: ایجاد متریال تنه درخت
        const trunkMaterial = new BABYLON.StandardMaterial("trunkMaterial", this.scene);
        trunkMaterial.diffuseColor = new BABYLON.Color3(0.4, 0.2, 0.1);
        trunk.material = trunkMaterial;
        
        // خط 26: ایجاد تاج درخت
        const leaves = BABYLON.MeshBuilder.CreateSphere("leaves", {
            diameter: 6
        }, this.scene);
        
        // خط 27: ایجاد متریال برگ‌ها
        const leavesMaterial = new BABYLON.StandardMaterial("leavesMaterial", this.scene);
        leavesMaterial.diffuseColor = new BABYLON.Color3(0.1, 0.5, 0.1);
        leaves.material = leavesMaterial;
        
        // خط 28: قرار دادن تاج روی تنه
        leaves.position.y = 5;
        
        // خط 29: گروه‌بندی درخت
        const tree = new BABYLON.TransformNode("tree", this.scene);
        trunk.parent = tree;
        leaves.parent = tree;
        
        // خط 30: قرار دادن درخت در موقعیت مشخص
        tree.position.set(x, y, z);
        
        this.trees.push(tree);
    }
    
    // خط 31: تابع ایجاد صخره‌ها
    generateRocks() {
        // خط 32: ایجاد 30 صخره در موقعیت‌های تصادفی
        for (let i = 0; i < 30; i++) {
            this.createRock(
                Math.random() * GameConfig.world.size - GameConfig.world.size / 2,
                0,
                Math.random() * GameConfig.world.size - GameConfig.world.size / 2
            );
        }
    }
    
    // خط 33: تابع ایجاد یک صخره
    createRock(x, y, z) {
        // خط 34: ایجاد صخره با mesh کره تغییر شکل داده شده
        const rock = BABYLON.MeshBuilder.CreateSphere("rock", {
            diameter: 3 + Math.random() * 4
        }, this.scene);
        
        // خط 35: تغییر شکل صخره برای طبیعی‌تر شدن
        const positions = rock.getVerticesData(BABYLON.VertexBuffer.PositionKind);
        for (let i = 0; i < positions.length; i += 3) {
            positions[i] += (Math.random() - 0.5) * 0.5;
            positions[i + 1] += (Math.random() - 0.5) * 0.5;
            positions[i + 2] += (Math.random() - 0.5) * 0.5;
        }
        rock.updateVerticesData(BABYLON.VertexBuffer.PositionKind, positions);
        
        // خط 36: ایجاد متریال صخره
        const rockMaterial = new BABYLON.StandardMaterial("rockMaterial", this.scene);
        rockMaterial.diffuseColor = new BABYLON.Color3(0.3, 0.3, 0.3);
        rockMaterial.specularColor = new BABYLON.Color3(0.1, 0.1, 0.1);
        rock.material = rockMaterial;
        
        // خط 37: قرار دادن صخره در موقعیت مشخص
        rock.position.set(x, y, z);
        
        this.rocks.push(rock);
    }
    
    // خط 38: تابع تنظیم نورپردازی
    setupLighting() {
        // خط 39: ایجاد نور خورشید
        const sunLight = new BABYLON.DirectionalLight("sunLight", 
            new BABYLON.Vector3(-1, -2, -1), this.scene);
        sunLight.intensity = 0.8;
        sunLight.shadowEnabled = true;
        
        // خط 40: ایجاد نور محیطی
        const ambientLight = new BABYLON.HemisphericLight("ambientLight", 
            new BABYLON.Vector3(0, 1, 0), this.scene);
        ambientLight.intensity = 0.3;
        
        // خط 41: ایجاد نور نقطه‌ای برای جلوه‌های خاص
        const pointLight = new BABYLON.PointLight("pointLight", 
            new BABYLON.Vector3(0, 10, 0), this.scene);
        pointLight.intensity = 0.5;
    }
}
            // خط 1: کلاس مدیریت قبیله
class TribeManager {
    // خط 2: سازنده کلاس
    constructor(scene) {
        this.scene = scene;
        this.tribes = [];
        this.selectedTribe = null;
        this.buildings = [];
        this.units = [];
        
        // خط 3: ایجاد قبایل اولیه
        this.createInitialTribes();
    }
    
    // خط 4: تابع ایجاد قبایل اولیه
    createInitialTribes() {
        // خط 5: ایجاد قبیله بازیکن
        const playerTribe = this.createTribe(
            0, 0, 
            "قبیله شما", 
            TribeColors.player, 
            true
        );
        
        // خط 6: ایجاد قبایل دشمن
        const enemyPositions = [
            { x: 200, z: 200 },
            { x: -200, z: 200 },
            { x: 200, z: -200 }
        ];
        
        // خط 7: ایجاد 3 قبیله دشمن
        enemyPositions.forEach((pos, index) => {
            this.createTribe(
                pos.x, pos.z,
                `قبیله دشمن ${index + 1}`,
                Object.values(TribeColors)[index + 1],
                false
            );
        });
        
        // خط 8: انتخاب قبیله بازیکن به عنوان پیش‌فرض
        this.selectedTribe = playerTribe;
    }
    
    // خط 9: تابع ایجاد یک قبیله جدید
    createTribe(x, z, name, color, isPlayer) {
        // خط 10: شیء قبیله
        const tribe = {
            id: this.tribes.length,
            name: name,
            color: color,
            isPlayer: isPlayer,
            position: { x: x, z: z },
            population: GameConfig.resources.startingPopulation,
            food: GameConfig.resources.startingFood,
            wood: GameConfig.resources.startingWood,
            stone: GameConfig.resources.startingStone,
            warriors: 2,
            huts: 1,
            buildings: [],
            units: []
        };
        
        // خط 11: ایجاد ساختمان‌های اولیه قبیله
        this.createInitialBuildings(tribe);
        
        // خط 12: ایجاد واحدهای اولیه
        this.createInitialUnits(tribe);
        
        // خط 13: اضافه کردن قبیله به لیست
        this.tribes.push(tribe);
        
        return tribe;
    }
    
    // خط 14: تابع ایجاد ساختمان‌های اولیه قبیله
    createInitialBuildings(tribe) {
        // خط 15: ایجاد کلبه اصلی
        const mainHut = this.createBuilding(
            tribe.position.x,
            tribe.position.z,
            BuildingTypes.HUT,
            tribe
        );
        
        // خط 16: ایجاد انبار
        const storage = this.createBuilding(
            tribe.position.x + 10,
            tribe.position.z,
            BuildingTypes.STORAGE,
            tribe
        );
        
        // خط 17: اضافه کردن ساختمان‌ها به قبیله
        tribe.buildings.push(mainHut, storage);
    }
    
    // خط 18: تابع ایجاد یک ساختمان
    createBuilding(x, z, type, tribe) {
        // خط 19: ایجاد mesh ساختمان
        let buildingMesh;
        
        // خط 20: ایجاد mesh بر اساس نوع ساختمان
        switch(type) {
            case BuildingTypes.HUT:
                // خط 21: ایجاد کلبه
                buildingMesh = BABYLON.MeshBuilder.CreateCylinder("hut", {
                    height: 6,
                    diameter: 8
                }, this.scene);
                break;
                
            case BuildingTypes.BARRACKS:
                // خط 22: ایجاد سربازخانه
                buildingMesh = BABYLON.MeshBuilder.CreateBox("barracks", {
                    height: 5,
                    width: 12,
                    depth: 8
                }, this.scene);
                break;
                
            case BuildingTypes.STORAGE:
                // خط 23: ایجاد انبار
                buildingMesh = BABYLON.MeshBuilder.CreateBox("storage", {
                    height: 4,
                    width: 6,
                    depth: 6
                }, this.scene);
                break;
        }
        
        // خط 24: ایجاد متریال ساختمان
        const buildingMaterial = new BABYLON.StandardMaterial("buildingMaterial", this.scene);
        buildingMaterial.diffuseColor = BABYLON.Color3.FromHexString(tribe.color);
        buildingMesh.material = buildingMaterial;
        
        // خط 25: قرار دادن ساختمان در موقعیت مشخص
        buildingMesh.position.set(x, 3, z);
        
        // خط 26: شیء ساختمان
        const building = {
            mesh: buildingMesh,
            type: type,
            tribe: tribe,
            level: 1,
            position: { x: x, z: z }
        };
        
        // خط 27: اضافه کردن به لیست ساختمان‌ها
        this.buildings.push(building);
        
        return building;
    }
    
    // خط 28: تابع ایجاد واحدهای اولیه
    createInitialUnits(tribe) {
        // خط 29: ایجاد 2 جنگجو
        for (let i = 0; i < 2; i++) {
            this.createUnit(
                tribe.position.x + (Math.random() - 0.5) * 20,
                tribe.position.z + (Math.random() - 0.5) * 20,
                UnitTypes.WARRIOR,
                tribe
            );
        }
        
        // خط 30: ایجاد 3 کارگر
        for (let i = 0; i < 3; i++) {
            this.createUnit(
                tribe.position.x + (Math.random() - 0.5) * 20,
                tribe.position.z + (Math.random() - 0.5) * 20,
                UnitTypes.WORKER,
                tribe
            );
        }
    }
    
    // خط 31: تابع ایجاد یک واحد
    createUnit(x, z, type, tribe) {
        // خط 32: ایجاد mesh واحد
        let unitMesh;
        
        // خط 33: ایجاد mesh بر اساس نوع واحد
        switch(type) {
            case UnitTypes.WARRIOR:
                // خط 34: ایجاد جنگجو
                unitMesh = BABYLON.MeshBuilder.CreateCylinder("warrior", {
                    height: 3,
                    diameter: 1
                }, this.scene);
                break;
                
            case UnitTypes.WORKER:
                // خط 35: ایجاد کارگر
                unitMesh = BABYLON.MeshBuilder.CreateBox("worker", {
                    height: 2,
                    size: 1
                }, this.scene);
                break;
        }
        
        // خط 36: ایجاد متریال واحد
        const unitMaterial = new BABYLON.StandardMaterial("unitMaterial", this.scene);
        unitMaterial.diffuseColor = BABYLON.Color3.FromHexString(tribe.color);
        unitMesh.material = unitMaterial;
        
        // خط 37: قرار دادن واحد در موقعیت مشخص
        unitMesh.position.set(x, 1.5, z);
        
        // خط 38: شیء واحد
        const unit = {
            mesh: unitMesh,
            type: type,
            tribe: tribe,
            position: { x: x, z: z },
            target: null,
            speed: type === UnitTypes.WARRIOR ? 0.5 : 0.3
        };
        
        // خط 39: اضافه کردن به لیست واحدها
        this.units.push(unit);
        tribe.units.push(unit);
        
        return unit;
    }
    
    // خط 40: تابع آموزش جنگجوی جدید
    trainWarrior(tribe) {
        // خط 41: بررسی منابع کافی
        if (tribe.food >= GameConfig.tribe.warriorCost) {
            // خط 42: کسر منابع
            tribe.food -= GameConfig.tribe.warriorCost;
            tribe.warriors++;
            
            // خط 43: ایجاد جنگجوی جدید
            this.createUnit(
                tribe.position.x + (Math.random() - 0.5) * 10,
                tribe.position.z + (Math.random() - 0.5) * 10,
                UnitTypes.WARRIOR,
                tribe
            );
            
            return true;
        }
        return false;
    }
    
    // خط 44: تابع ساخت کلبه جدید
    buildHut(tribe) {
        // خط 45: بررسی منابع کافی
        if (tribe.wood >= GameConfig.tribe.hutCost.wood && 
            tribe.stone >= GameConfig.tribe.hutCost.stone) {
            
            // خط 46: کسر منابع
            tribe.wood -= GameConfig.tribe.hutCost.wood;
            tribe.stone -= GameConfig.tribe.hutCost.stone;
            tribe.huts++;
            tribe.population += 2;
            
            // خط 47: ایجاد کلبه جدید
            this.createBuilding(
                tribe.position.x + (Math.random() - 0.5) * 30,
                tribe.position.z + (Math.random() - 0.5) * 30,
                BuildingTypes.HUT,
                tribe
            );
            
            return true;
        }
        return false;
    }
    
    // خط 48: تابع به روزرسانی وضعیت قبایل
    update() {
        // خط 49: تولید منابع برای هر قبیله
        this.tribes.forEach(tribe => {
            tribe.food += tribe.huts * 2;
            tribe.wood += tribe.units.filter(u => u.type === UnitTypes.WORKER).length;
        });
        
        // خط 50: به روزرسانی UI
        this.updateUI();
    }
    
    // خط 51: تابع به روزرسانی رابط کاربری
    updateUI() {
        if (this.selectedTribe) {
            document.getElementById('population').textContent = this.selectedTribe.population;
            document.getElementById('food').textContent = Math.floor(this.selectedTribe.food);
            document.getElementById('wood').textContent = Math.floor(this.selectedTribe.wood);
            document.getElementById('stone').textContent = Math.floor(this.selectedTribe.stone);
        }
    }
}
            // خط 1: کلاس کنترل دوربین
class CameraController {
    // خط 2: سازنده کلاس
    constructor(scene, canvas) {
        this.scene = scene;
        this.canvas = canvas;
        this.camera = null;
        this.target = null;
        this.zoomLevel = 1;
        
        // خط 3: ایجاد دوربین
        this.createCamera();
        
        // خط 4: تنظیم کنترل‌ها
        this.setupControls();
    }
    
    // خط 5: تابع ایجاد دوربین
    createCamera() {
        // خط 6: ایجاد دوربین ArcRotate برای نمای بالا
        this.camera = new BABYLON.ArcRotateCamera(
            "camera",
            -Math.PI / 2,
            Math.PI / 3,
            100,
            new BABYLON.Vector3(0, 0, 0),
            this.scene
        );
        
        // خط 7: تنظیم محدودیت‌های دوربین
        this.camera.lowerBetaLimit = Math.PI / 6;
        this.camera.upperBetaLimit = Math.PI / 2;
        this.camera.lowerRadiusLimit = 30;
        this.camera.upperRadiusLimit = 500;
        this.camera.wheelPrecision = 50;
        
        // خط 8: متصل کردن دوربین به کانواس
        this.camera.attachControl(this.canvas, true);
    }
    
    // خط 9: تابع تنظیم کنترل‌ها
    setupControls() {
        // خط 10: کنترل‌های کیبورد برای حرکت دوربین
        this.scene.onKeyboardObservable.add((kbInfo) => {
            switch (kbInfo.type) {
                case BABYLON.KeyboardEventTypes.KEYDOWN:
                    // خط 11: حرکت دوربین با کلیدهای方向
                    const speed = 2;
                    switch (kbInfo.event.key) {
                        case "ArrowUp":
                            this.camera.position.z -= speed;
                            break;
                        case "ArrowDown":
                            this.camera.position.z += speed;
                            break;
                        case "ArrowLeft":
                            this.camera.position.x -= speed;
                            break;
                        case "ArrowRight":
                            this.camera.position.x += speed;
                            break;
                    }
                    break;
            }
        });
        
        // خط 12: کنترل زوم با اسکرول ماوس
        this.scene.onPointerObservable.add((pointerInfo) => {
            if (pointerInfo.type === BABYLON.PointerEventTypes.POINTERWHEEL) {
                // خط 13: تنظیم سرعت زوم
                const zoomSpeed = 0.1;
                
                // خط 14: اعمال زوم
                if (pointerInfo.event.deltaY > 0) {
                    this.zoomOut();
                } else {
                    this.zoomIn();
                }
            }
        });
    }
    
    // خط 15: تابع بزرگنمایی
    zoomIn() {
        // خط 16: افزایش زوم تا حداکثر 3 برابر
        this.zoomLevel = Math.min(3, this.zoomLevel * 1.1);
        this.applyZoom();
    }
    
    // خط 17: تابع کوچکنمایی
    zoomOut() {
        // خط 18: کاهش زوم تا حداقل 0.5 برابر
        this.zoomLevel = Math.max(0.5, this.zoomLevel / 1.1);
        this.applyZoom();
    }
    
    // خط 19: تابع اعمال زوم
    applyZoom() {
        // خط 20: اعمال زوم بر روی دوربین
        this.camera.radius = 100 / this.zoomLevel;
    }
    
    // خط 21: تابع تمرکز روی هدف
    focusOnTarget(target) {
        // خط 22: تنظیم هدف دوربین
        this.camera.setTarget(target);
    }
    
    // خط 23: تابع حرکت به موقعیت مشخص
    moveToPosition(x, z) {
        // خط 24: حرکت دوربین به موقعیت جدید
        this.camera.position.x = x;
        this.camera.position.z = z;
    }
    
    // خط 25: تابع تنظیم ارتفاع دوربین
    setCameraHeight(height) {
        // خط 26: تنظیم ارتفاع دوربین
        this.camera.position.y = height;
    }
}
            // خط 1: تابع اصلی شروع بازی
    function startGame() {
    // خط 2: دریافت المان کانواس
    const canvas = document.getElementById("renderCanvas");
    
    // خط 3: ایجاد موتور Babylon.js
        const engine = new BABYLON.Engine(canvas, true, {
        preserveDrawingBuffer: true,
        stencil: true
    });
    
    // خط 4: ایجاد صحنه
    const scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color3(0.1, 0.1, 0.2);
    
    // خط 5: ایجاد مدیریت زمین
    const terrainManager = new TerrainManager(scene);
    
    // خط 6: ایجاد کنترل دوربین
    const cameraController = new CameraController(scene, canvas);
    
    // خط 7: ایجاد مدیریت قبایل
    const tribeManager = new TribeManager(scene);
    
    // خط 8: تنظیم رویدادهای UI
    setupUIEvents(tribeManager);
    
    // خط 9: تابع رندر حلقه بازی
    engine.runRenderLoop(function () {
        // خط 10: به روزرسانی منطق بازی
        tribeManager.update();
        
        // خط 11: رندر صحنه
        scene.render();
    });
    
    // خط 12: مدیریت تغییر سایز پنجره
    window.addEventListener("resize", function () {
        engine.resize();
    });
    
    // خط 13: ثبت در global برای دیباگ
    window.game = {
        scene: scene,
        terrainManager: terrainManager,
        tribeManager: tribeManager,
        cameraController: cameraController
    };
}

// خط 14: تابع تنظیم رویدادهای UI
function setupUIEvents(tribeManager) {
    // خط 15: دکمه آموزش جنگجو
    document.getElementById('addWarrior').addEventListener('click', function() {
        if (tribeManager.selectedTribe) {
            const success = tribeManager.trainWarrior(tribeManager.selectedTribe);
            if (success) {
                console.log("جنگجوی جدید آموزش داده شد!");
            } else {
                console.log("منابع کافی نیست!");
            }
        }
    });
    
    // خط 16: دکمه ساخت کلبه
    document.getElementById('buildHut').addEventListener('click', function() {
        if (tribeManager.selectedTribe) {
            const success = tribeManager.buildHut(tribeManager.selectedTribe);
            if (success) {
                console.log("کلبه جدید ساخته شد!");
            } else {
                console.log("منابع کافی نیست!");
            }
        }
    });
    
    // خط 17: دکمه‌های زوم
    document.getElementById('zoomIn').addEventListener('click', function() {
        window.game.cameraController.zoomIn();
    });
    
    document.getElementById('zoomOut').addEventListener('click', function() {
        window.game.cameraController.zoomOut();
    });
}

// خط 18: شروع بازی وقتی صفحه کاملاً لود شد
window.addEventListener('DOMContentLoaded', function() {
    // خط 19: نمایش پیام شروع
    console.log("بازی قبیله‌ای در حال بارگذاری...");
    
    // خط 20: شروع بازی
    startGame();
    
    // خط 21: نمایش پیام موفقیت
    console.log("بازی با موفقیت بارگذاری شد!");
});
            </body>
        </html>
