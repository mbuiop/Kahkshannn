<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash 3D Pro - Ú©Ù„Ø´ Ø³Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0a0f1d;
            color: white;
            overflow: hidden;
            user-select: none;
        }
        
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* UI Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
        #topUI {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }
        
        #resourcesPanel {
            display: flex;
            gap: 20px;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid;
            font-weight: bold;
            font-size: 16px;
            min-width: 120px;
        }
        
        .resource-item.gold {
            border-color: #FFD700;
            color: #FFD700;
        }
        
        .resource-item.elixir {
            border-color: #9C27B0;
            color: #9C27B0;
        }
        
        .resource-item.dark-elixir {
            border-color: #4A235A;
            color: #BB8FCE;
        }
        
        .resource-item.gems {
            border-color: #00BFFF;
            color: #00BFFF;
        }
        
        #playerInfo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #playerLevel {
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #4CAF50;
            font-weight: bold;
        }
        
        #playerName {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
        }
        
        /* UI Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
        #bottomUI {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding: 15px;
            z-index: 100;
            gap: 15px;
        }
        
        #buildPanel {
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 15px;
            border: 2px solid #555;
        }
        
        .build-button {
            width: 70px;
            height: 70px;
            background: rgba(50, 50, 50, 0.8);
            border: 2px solid #777;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-size: 12px;
            gap: 5px;
        }
        
        .build-button:hover {
            transform: scale(1.05);
            border-color: #FFD700;
            background: rgba(70, 70, 70, 0.9);
        }
        
        .build-button i {
            font-size: 24px;
        }
        
        #actionPanel {
            display: flex;
            gap: 15px;
        }
        
        .action-button {
            background: linear-gradient(45deg, #4CAF50, #2E7D32);
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
        }
        
        .action-button:hover {
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            transform: scale(1.05);
        }
        
        .action-button.attack {
            background: linear-gradient(45deg, #F44336, #C62828);
        }
        
        .action-button.attack:hover {
            background: linear-gradient(45deg, #C62828, #F44336);
        }
        
        .action-button.upgrade {
            background: linear-gradient(45deg, #FF9800, #EF6C00);
        }
        
        .action-button.upgrade:hover {
            background: linear-gradient(45deg, #EF6C00, #FF9800);
        }
        
        /* Ù†ÙˆØ§Ø± Ø³Ù„Ø§Ù…Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ */
        #baseHealth {
            position: fixed;
            bottom: 160px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid red;
            font-size: 16px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF0000, #FF4500);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        /* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ¬ */
        #waveInfo {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #2196F3;
            font-size: 16px;
            z-index: 100;
            display: flex;
            gap: 15px;
        }
        
        /* UI Ø§Ø±ØªÙ‚Ø§Ø¡ */
        #upgradeUI {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid gold;
            color: white;
            z-index: 1000;
            display: none;
            text-align: center;
            min-width: 400px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .upgrade-header {
            font-size: 24px;
            margin-bottom: 20px;
            color: #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .upgrade-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .upgrade-stats {
            text-align: right;
            background: rgba(50, 50, 50, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .upgrade-cost {
            text-align: left;
            background: rgba(50, 50, 50, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .upgrade-button {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            width: 200px;
        }
        
        .upgrade-button:hover {
            background: linear-gradient(45deg, #FFA500, #FFD700);
            transform: scale(1.05);
        }
        
        .upgrade-button:disabled {
            background: #777;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ */
        .notification {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            color: white;
            z-index: 120;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        /* Ø³Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ */
        .selected-structure {
            position: fixed;
            bottom: 320px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
            color: white;
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        
        /* ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0f1d;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            gap: 30px;
        }
        
        .loading-bar-container {
            width: 300px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #0D47A1);
            border-radius: 10px;
            transition: width 0.5s;
            width: 0%;
        }
        
        .loading-text {
            font-size: 20px;
            color: #FFD700;
        }
        
        /* Ù…Ù†Ùˆ Ø§ØµÙ„ÛŒ */
        #mainMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            gap: 30px;
        }
        
        .game-title {
            font-size: 60px;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            margin-bottom: 30px;
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 300px;
        }
        
        .menu-button {
            background: linear-gradient(45deg, #2196F3, #0D47A1);
            border: none;
            padding: 20px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .menu-button:hover {
            background: linear-gradient(45deg, #0D47A1, #2196F3);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ -->
    <div id="loadingScreen">
        <div class="game-title">Clash 3D Pro</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-text" id="loadingText">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ...</div>
    </div>

    <!-- Ù…Ù†Ùˆ Ø§ØµÙ„ÛŒ -->
    <div id="mainMenu">
        <div class="game-title">Clash 3D Pro</div>
        <div class="menu-buttons">
            <button class="menu-button" id="startGameBtn">
                <i class="fas fa-play"></i> Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
            </button>
            <button class="menu-button" id="tutorialBtn">
                <i class="fas fa-graduation-cap"></i> Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø§Ø²ÛŒ
            </button>
        </div>
    </div>

    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¨Ø§Ø²ÛŒ -->
    <div id="gameContainer"></div>

    <!-- UI Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ -->
    <div id="topUI">
        <div id="resourcesPanel">
            <div class="resource-item gold">
                <i class="fas fa-coins"></i>
                <span id="goldCount">10,000</span>
            </div>
            <div class="resource-item elixir">
                <i class="fas fa-flask"></i>
                <span id="elixirCount">5,000</span>
            </div>
            <div class="resource-item dark-elixir">
                <i class="fas fa-skull"></i>
                <span id="darkElixirCount">1,000</span>
            </div>
            <div class="resource-item gems">
                <i class="fas fa-gem"></i>
                <span id="gemsCount">500</span>
            </div>
        </div>
        
        <div id="playerInfo">
            <div id="playerLevel">
                <i class="fas fa-star"></i> Ø³Ø·Ø­ <span id="playerLevelValue">5</span>
            </div>
            <div id="playerName">Ø¯Ù‡Ú©Ø¯Ù‡ Ø´Ù…Ø§</div>
        </div>
    </div>

    <!-- Ù†ÙˆØ§Ø± Ø³Ù„Ø§Ù…Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ -->
    <div id="baseHealth">
        <div>ğŸ° Ø³Ù„Ø§Ù…Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡: <span id="healthValue">2,500</span>/<span id="maxHealthValue">2,500</span></div>
        <div class="health-bar">
            <div class="health-fill" id="healthBar"></div>
        </div>
    </div>

    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ¬ -->
    <div id="waveInfo">
        <div>Ù…ÙˆØ¬: <span id="waveNumber">1</span></div>
        <div>Ø¯Ø´Ù…Ù†Ø§Ù†: <span id="enemyCount">0</span></div>
        <div>Ø²Ù…Ø§Ù† ØªØ§ Ø­Ù…Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ: <span id="nextAttackTime">20</span> Ø«Ø§Ù†ÛŒÙ‡</div>
    </div>

    <!-- UI Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ -->
    <div id="bottomUI">
        <div id="buildPanel">
            <div class="build-button" data-building="townhall">
                <i class="fas fa-landmark"></i>
                <span>Ø³Ø§Ù„Ù† Ø´Ù‡Ø±</span>
            </div>
            <div class="build-button" data-building="barracks">
                <i class="fas fa-helmet-battle"></i>
                <span>Ø³Ø±Ø¨Ø§Ø²Ø®Ø§Ù†Ù‡</span>
            </div>
            <div class="build-button" data-building="goldmine">
                <i class="fas fa-mountain"></i>
                <span>Ù…Ø¹Ø¯Ù† Ø·Ù„Ø§</span>
            </div>
            <div class="build-button" data-building="elixircollector">
                <i class="fas fa-vial"></i>
                <span>Ø¸Ø±Ù Ø§Ú©Ø³ÛŒØ±</span>
            </div>
            <div class="build-button" data-building="cannon">
                <i class="fas fa-crosshairs"></i>
                <span>ØªÙˆÙ¾</span>
            </div>
            <div class="build-button" data-building="archertower">
                <i class="fas fa-bow-arrow"></i>
                <span>Ø¨Ø±Ø¬ Ú©Ù…Ø§Ù†Ø¯Ø§Ø±</span>
            </div>
            <div class="build-button" data-building="wall">
                <i class="fas fa-wall"></i>
                <span>Ø¯ÛŒÙˆØ§Ø±</span>
            </div>
        </div>
        
        <div id="actionPanel">
            <button class="action-button" id="attackBtn">
                <i class="fas fa-fist-raised"></i> Ø­Ù…Ù„Ù‡ Ø¨Ù‡ Ø¯Ø´Ù…Ù†
            </button>
            <button class="action-button upgrade" id="upgradeBtn">
                <i class="fas fa-hammer"></i> Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø²Ù‡
            </button>
            <button class="action-button" id="trainTroopsBtn">
                <i class="fas fa-user-plus"></i> Ø¢Ù…ÙˆØ²Ø´ Ø³Ø±Ø¨Ø§Ø²
            </button>
        </div>
    </div>

    <!-- Ø³Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ -->
    <div class="selected-structure" id="selectedStructure">
        <div id="structureName">Ø³Ø§Ø²Ù‡</div>
        <div>Ø³Ø·Ø­: <span id="structureLevel">1</span></div>
        <div>Ø³Ù„Ø§Ù…Øª: <span id="structureHealth">100</span>/<span id="structureMaxHealth">100</span></div>
        <button class="action-button upgrade" id="upgradeStructureBtn" style="margin-top: 10px; padding: 8px 15px; font-size: 14px;">
            <i class="fas fa-arrow-up"></i> Ø§Ø±ØªÙ‚Ø§Ø¡
        </button>
    </div>

    <!-- UI Ø§Ø±ØªÙ‚Ø§Ø¡ -->
    <div id="upgradeUI">
        <div class="upgrade-header">
            <i class="fas fa-arrow-up"></i>
            <span id="upgradeTitle">Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø²Ù‡</span>
        </div>
        
        <div class="upgrade-content">
            <div class="upgrade-stats">
                <h3>Ù…Ø´Ø®ØµØ§Øª ÙØ¹Ù„ÛŒ</h3>
                <div id="currentStats">
                    <!-- Ø¢Ù…Ø§Ø± ÙØ¹Ù„ÛŒ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
            <div class="upgrade-cost">
                <h3>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±ØªÙ‚Ø§Ø¡</h3>
                <div id="upgradeCosts">
                    <!-- Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
        </div>
        
        <div>
            <button class="upgrade-button" id="confirmUpgradeBtn">Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¯Ù‡ÛŒØ¯</button>
            <button class="upgrade-button" id="cancelUpgradeBtn">Ù„ØºÙˆ</button>
        </div>
    </div>

    <!-- Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ -->
    <div class="notification" id="notification">
        <i class="fas fa-bell"></i>
        <span id="notificationText">Ø§ÛŒÙ† ÛŒÚ© Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ Ø§Ø³Øª</span>
    </div>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ ====================
        let scene, camera, renderer, controls;
        let gameState = {
            resources: {
                gold: 10000,
                elixir: 5000,
                darkElixir: 1000,
                gems: 500
            },
            playerLevel: 5,
            baseHealth: 2500,
            maxBaseHealth: 2500,
            waveNumber: 1,
            enemyCount: 0,
            nextAttackTime: 20,
            structures: [],
            selectedStructure: null,
            enemies: [],
            troops: [],
            projectiles: []
        };

        const structureData = {
            townhall: { name: "Ø³Ø§Ù„Ù† Ø´Ù‡Ø±", health: 2000, cost: { gold: 0, elixir: 0 }, level: 1, maxLevel: 10 },
            barracks: { name: "Ø³Ø±Ø¨Ø§Ø²Ø®Ø§Ù†Ù‡", health: 500, cost: { gold: 1000, elixir: 500 }, level: 1, maxLevel: 10 },
            goldmine: { name: "Ù…Ø¹Ø¯Ù† Ø·Ù„Ø§", health: 300, cost: { gold: 800, elixir: 0 }, level: 1, maxLevel: 10 },
            elixircollector: { name: "Ø¸Ø±Ù Ø§Ú©Ø³ÛŒØ±", health: 300, cost: { gold: 0, elixir: 800 }, level: 1, maxLevel: 10 },
            cannon: { name: "ØªÙˆÙ¾", health: 400, cost: { gold: 1200, elixir: 0 }, level: 1, maxLevel: 8 },
            archertower: { name: "Ø¨Ø±Ø¬ Ú©Ù…Ø§Ù†Ø¯Ø§Ø±", health: 450, cost: { gold: 1500, elixir: 500 }, level: 1, maxLevel: 8 },
            wall: { name: "Ø¯ÛŒÙˆØ§Ø±", health: 200, cost: { gold: 200, elixir: 0 }, level: 1, maxLevel: 12 }
        };

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Three.js ====================
        function initThreeJS() {
            // Ø§ÛŒØ¬Ø§Ø¯ ØµØ­Ù†Ù‡
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 100, 300);

            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÙˆØ±Ø¨ÛŒÙ†
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 100, 150);
            camera.lookAt(0, 0, 0);

            // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ù†Ø¯Ø±Ø±
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('gameContainer').appendChild(renderer.domElement);

            // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 50;
            controls.maxDistance = 300;
            controls.maxPolarAngle = Math.PI / 2;

            // Ù†ÙˆØ±Ù¾Ø±Ø¯Ø§Ø²ÛŒ
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            // Ø§ÛŒØ¬Ø§Ø¯ Ø²Ù…ÛŒÙ†
            createGround();
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
            createInitialStructures();

            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ
            startGame();
        }

        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø²Ù…ÛŒÙ† ====================
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(200, 200, 50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4CAF50,
                side: THREE.DoubleSide
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Ø§ÛŒØ¬Ø§Ø¯ grid Ø±ÙˆÛŒ Ø²Ù…ÛŒÙ†
            const gridHelper = new THREE.GridHelper(200, 20, 0x000000, 0x000000);
            gridHelper.material.opacity = 0.2;
            gridHelper.material.transparent = true;
            scene.add(gridHelper);
        }

        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        function createInitialStructures() {
            // Ø³Ø§Ù„Ù† Ø´Ù‡Ø± Ø¯Ø± Ù…Ø±Ú©Ø²
            createStructure('townhall', 0, 0);
            
            // Ø³Ø±Ø¨Ø§Ø²Ø®Ø§Ù†Ù‡
            createStructure('barracks', -20, 15);
            
            // Ù…Ø¹Ø¯Ù† Ø·Ù„Ø§
            createStructure('goldmine', 25, -20);
            
            // Ø¸Ø±Ù Ø§Ú©Ø³ÛŒØ±
            createStructure('elixircollector', -25, -20);
            
            // ØªÙˆÙ¾â€ŒÙ‡Ø§
            createStructure('cannon', 15, 25);
            createStructure('cannon', -15, 25);
            
            // Ø¨Ø±Ø¬ Ú©Ù…Ø§Ù†Ø¯Ø§Ø±
            createStructure('archertower', 30, 0);
            createStructure('archertower', -30, 0);
            
            // Ø¯ÛŒÙˆØ§Ø±Ù‡Ø§
            for (let i = -35; i <= 35; i += 10) {
                if (Math.abs(i) > 10) {
                    createStructure('wall', i, 35);
                    createStructure('wall', i, -35);
                    createStructure('wall', 35, i);
                    createStructure('wall', -35, i);
                }
            }
        }

        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø²Ù‡ ====================
        function createStructure(type, x, z) {
            const data = structureData[type];
            if (!data) return;

            let geometry, material, color;
            
            // ØªØ¹ÛŒÛŒÙ† Ø±Ù†Ú¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø³Ø§Ø²Ù‡
            switch(type) {
                case 'townhall':
                    color = 0xFFD700;
                    geometry = new THREE.BoxGeometry(12, 8, 12);
                    break;
                case 'barracks':
                    color = 0x2196F3;
                    geometry = new THREE.BoxGeometry(8, 6, 8);
                    break;
                case 'goldmine':
                    color = 0xFFD700;
                    geometry = new THREE.CylinderGeometry(4, 5, 6, 8);
                    break;
                case 'elixircollector':
                    color = 0x9C27B0;
                    geometry = new THREE.CylinderGeometry(4, 5, 6, 8);
                    break;
                case 'cannon':
                    color = 0x795548;
                    geometry = new THREE.CylinderGeometry(3, 4, 5, 8);
                    break;
                case 'archertower':
                    color = 0x4CAF50;
                    geometry = new THREE.CylinderGeometry(3, 4, 8, 8);
                    break;
                case 'wall':
                    color = 0x9E9E9E;
                    geometry = new THREE.BoxGeometry(8, 4, 2);
                    break;
                default:
                    color = 0xFFFFFF;
                    geometry = new THREE.BoxGeometry(5, 5, 5);
            }

            material = new THREE.MeshLambertMaterial({ color: color });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(x, geometry.parameters.height / 2, z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            scene.add(mesh);

            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù‡
            const structure = {
                type: type,
                name: data.name,
                mesh: mesh,
                x: x,
                z: z,
                health: data.health,
                maxHealth: data.health,
                level: data.level,
                maxLevel: data.maxLevel,
                cost: data.cost
            };

            gameState.structures.push(structure);
            return structure;
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ ====================
        function startGame() {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateUI();
            
            // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø± Ø­Ù…Ù„Ù‡ Ø¯Ø´Ù…Ù†
            setInterval(updateAttackTimer, 1000);
            
            // Ø´Ø±ÙˆØ¹ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
            animate();
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡
            showNotification("Ø¯Ù‡Ú©Ø¯Ù‡ Ø´Ù…Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯! Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ø³Ø§Ø®Øª Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§ Ú©Ù†ÛŒØ¯.");
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§ÛŒÙ…Ø± Ø­Ù…Ù„Ù‡ ====================
        function updateAttackTimer() {
            if (gameState.nextAttackTime > 0) {
                gameState.nextAttackTime--;
                document.getElementById('nextAttackTime').textContent = gameState.nextAttackTime;
            } else {
                // Ø´Ø±ÙˆØ¹ Ø­Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯
                startEnemyAttack();
                gameState.nextAttackTime = 20;
                gameState.waveNumber++;
                document.getElementById('waveNumber').textContent = gameState.waveNumber;
            }
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø­Ù…Ù„Ù‡ Ø¯Ø´Ù…Ù† ====================
        function startEnemyAttack() {
            const enemyCount = 5 + gameState.waveNumber;
            gameState.enemyCount = enemyCount;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø´Ù…Ù†Ø§Ù†
            for (let i = 0; i < enemyCount; i++) {
                createEnemy();
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            document.getElementById('enemyCount').textContent = gameState.enemyCount;
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡
            showNotification(`Ø­Ù…Ù„Ù‡ Ù…ÙˆØ¬ ${gameState.waveNumber} Ø´Ø±ÙˆØ¹ Ø´Ø¯! ${enemyCount} Ø¯Ø´Ù…Ù† Ø¨Ù‡ Ø¯Ù‡Ú©Ø¯Ù‡ Ø´Ù…Ø§ Ø­Ù…Ù„Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.`);
        }

        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø´Ù…Ù† ====================
        function createEnemy() {
            const geometry = new THREE.CylinderGeometry(2, 2, 5, 8);
            const material = new THREE.MeshLambertMaterial({ color: 0xFF0000 });
            const mesh = new THREE.Mesh(geometry, material);
            
            // Ù…ÙˆÙ‚Ø¹ÛŒØª ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± Ø§Ø·Ø±Ø§Ù Ø¯Ù‡Ú©Ø¯Ù‡
            const angle = Math.random() * Math.PI * 2;
            const distance = 80 + Math.random() * 40;
            const x = Math.cos(angle) * distance;
            const z = Math.sin(angle) * distance;
            
            mesh.position.set(x, 2.5, z);
            mesh.castShadow = true;
            scene.add(mesh);
            
            const enemy = {
                mesh: mesh,
                x: x,
                z: z,
                health: 50 + (gameState.waveNumber * 10),
                speed: 0.5 + (Math.random() * 0.3),
                target: null,
                attackCooldown: 0
            };
            
            gameState.enemies.push(enemy);
            return enemy;
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø´Ù…Ù†Ø§Ù† ====================
        function updateEnemies() {
            for (let i = gameState.enemies.length - 1; i >= 0; i--) {
                const enemy = gameState.enemies[i];
                
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ø³Ø§Ø²Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù‡Ø¯Ù
                if (!enemy.target) {
                    let closestDistance = Infinity;
                    let closestStructure = null;
                    
                    for (const structure of gameState.structures) {
                        const dx = structure.x - enemy.x;
                        const dz = structure.z - enemy.z;
                        const distance = Math.sqrt(dx * dx + dz * dz);
                        
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestStructure = structure;
                        }
                    }
                    
                    enemy.target = closestStructure;
                }
                
                // Ø­Ø±Ú©Øª Ø¨Ù‡ Ø³Ù…Øª Ù‡Ø¯Ù
                if (enemy.target) {
                    const dx = enemy.target.x - enemy.x;
                    const dz = enemy.target.z - enemy.z;
                    const distance = Math.sqrt(dx * dx + dz * dz);
                    
                    if (distance > 5) {
                        enemy.x += (dx / distance) * enemy.speed * 0.1;
                        enemy.z += (dz / distance) * enemy.speed * 0.1;
                        enemy.mesh.position.set(enemy.x, 2.5, enemy.z);
                    } else {
                        // Ø­Ù…Ù„Ù‡ Ø¨Ù‡ Ø³Ø§Ø²Ù‡
                        if (enemy.attackCooldown <= 0) {
                            enemy.target.health -= 10;
                            enemy.attackCooldown = 60; // 1 Ø«Ø§Ù†ÛŒÙ‡
                            
                            // Ø§Ú¯Ø± Ø³Ø§Ø²Ù‡ Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯
                            if (enemy.target.health <= 0) {
                                removeStructure(enemy.target);
                                enemy.target = null;
                            }
                        } else {
                            enemy.attackCooldown--;
                        }
                    }
                } else {
                    // Ø­Ù…Ù„Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø§ØµÙ„ÛŒ
                    const dx = -enemy.x;
                    const dz = -enemy.z;
                    const distance = Math.sqrt(dx * dx + dz * dz);
                    
                    if (distance > 5) {
                        enemy.x += (dx / distance) * enemy.speed * 0.1;
                        enemy.z += (dz / distance) * enemy.speed * 0.1;
                        enemy.mesh.position.set(enemy.x, 2.5, enemy.z);
                    } else {
                        // Ø­Ù…Ù„Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡
                        if (enemy.attackCooldown <= 0) {
                            gameState.baseHealth -= 20;
                            enemy.attackCooldown = 60;
                            
                            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ù„Ø§Ù…Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡
                            updateBaseHealth();
                            
                            // Ø§Ú¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯
                            if (gameState.baseHealth <= 0) {
                                gameState.baseHealth = 0;
                                showNotification("Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯! Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯ÛŒØ¯.");
                            }
                        } else {
                            enemy.attackCooldown--;
                        }
                    }
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø¯Ø´Ù…Ù†
                if (enemy.health <= 0) {
                    scene.remove(enemy.mesh);
                    gameState.enemies.splice(i, 1);
                    gameState.enemyCount--;
                    document.getElementById('enemyCount').textContent = gameState.enemyCount;
                    
                    // Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª Ø¯Ø´Ù…Ù†
                    gameState.resources.gold += 50;
                    gameState.resources.elixir += 25;
                    updateUI();
                }
            }
        }

        // ==================== Ø­Ø°Ù Ø³Ø§Ø²Ù‡ ====================
        function removeStructure(structure) {
            scene.remove(structure.mesh);
            const index = gameState.structures.indexOf(structure);
            if (index > -1) {
                gameState.structures.splice(index, 1);
            }
            
            // Ø§Ú¯Ø± Ø³Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ Ù¾Ù†Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†
            if (gameState.selectedStructure === structure) {
                hideStructurePanel();
            }
            
            showNotification(`${structure.name} Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯!`);
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ù„Ø§Ù…Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ ====================
        function updateBaseHealth() {
            document.getElementById('healthValue').textContent = gameState.baseHealth;
            document.getElementById('maxHealthValue').textContent = gameState.maxBaseHealth;
            
            const healthPercent = (gameState.baseHealth / gameState.maxBaseHealth) * 100;
            document.getElementById('healthBar').style.width = `${healthPercent}%`;
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ====================
        function updateUI() {
            document.getElementById('goldCount').textContent = gameState.resources.gold.toLocaleString();
            document.getElementById('elixirCount').textContent = gameState.resources.elixir.toLocaleString();
            document.getElementById('darkElixirCount').textContent = gameState.resources.darkElixir.toLocaleString();
            document.getElementById('gemsCount').textContent = gameState.resources.gems.toLocaleString();
            document.getElementById('playerLevelValue').textContent = gameState.playerLevel;
        }

        // ==================== Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ ====================
        function showNotification(text) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationText').textContent = text;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ==================== Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø²Ù‡ ====================
        function selectStructure(structure) {
            gameState.selectedStructure = structure;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø³Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            document.getElementById('structureName').textContent = structure.name;
            document.getElementById('structureLevel').textContent = structure.level;
            document.getElementById('structureHealth').textContent = structure.health;
            document.getElementById('structureMaxHealth').textContent = structure.maxHealth;
            
            document.getElementById('selectedStructure').style.display = 'flex';
        }

        // ==================== Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø³Ø§Ø²Ù‡ ====================
        function hideStructurePanel() {
            document.getElementById('selectedStructure').style.display = 'none';
            gameState.selectedStructure = null;
        }

        // ==================== Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø²Ù‡ ====================
        function upgradeStructure(structure) {
            const nextLevel = structure.level + 1;
            
            if (nextLevel > structure.maxLevel) {
                showNotification("Ø§ÛŒÙ† Ø³Ø§Ø²Ù‡ Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± Ø³Ø·Ø­ Ø®ÙˆØ¯ Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª!");
                return;
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±ØªÙ‚Ø§Ø¡
            const upgradeCost = {
                gold: structure.cost.gold * nextLevel,
                elixir: structure.cost.elixir * nextLevel
            };
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ú©Ø§ÙÛŒ
            if (gameState.resources.gold < upgradeCost.gold || gameState.resources.elixir < upgradeCost.elixir) {
                showNotification("Ù…Ù†Ø§Ø¨Ø¹ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§Ø¡ Ù†Ø¯Ø§Ø±ÛŒØ¯!");
                return;
            }
            
            // Ú©Ø³Ø± Ù…Ù†Ø§Ø¨Ø¹
            gameState.resources.gold -= upgradeCost.gold;
            gameState.resources.elixir -= upgradeCost.elixir;
            
            // Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø²Ù‡
            structure.level = nextLevel;
            structure.health += 100;
            structure.maxHealth += 100;
            
            // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ø³Ø§Ø²Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­
            const hue = (nextLevel / structure.maxLevel) * 120; // Ø§Ø² Ø³Ø¨Ø² Ø¨Ù‡ Ø²Ø±Ø¯ Ø¨Ù‡ Ù‚Ø±Ù…Ø²
            structure.mesh.material.color.setHSL(hue / 360, 0.8, 0.5);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateUI();
            selectStructure(structure); // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ù†Ù„ Ø³Ø§Ø²Ù‡
            
            showNotification(`${structure.name} Ø¨Ù‡ Ø³Ø·Ø­ ${nextLevel} Ø§Ø±ØªÙ‚Ø§Ø¡ ÛŒØ§ÙØª!`);
        }

        // ==================== Ø³Ø§Ø®Øª Ø³Ø§Ø²Ù‡ Ø¬Ø¯ÛŒØ¯ ====================
        function buildStructure(type) {
            const data = structureData[type];
            if (!data) return;
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ú©Ø§ÙÛŒ
            if (gameState.resources.gold < data.cost.gold || gameState.resources.elixir < data.cost.elixir) {
                showNotification("Ù…Ù†Ø§Ø¨Ø¹ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø§ÛŒÙ† Ø³Ø§Ø²Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯!");
                return;
            }
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª
            let x, z;
            let attempts = 0;
            
            do {
                x = Math.floor(Math.random() * 60) - 30;
                z = Math.floor(Math.random() * 60) - 30;
                attempts++;
            } while (isPositionOccupied(x, z) && attempts < 100);
            
            if (attempts >= 100) {
                showNotification("ÙØ¶Ø§ÛŒ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø³Ø§Ø²Ù‡ Ø¬Ø¯ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!");
                return;
            }
            
            // Ú©Ø³Ø± Ù…Ù†Ø§Ø¨Ø¹
            gameState.resources.gold -= data.cost.gold;
            gameState.resources.elixir -= data.cost.elixir;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø²Ù‡
            const structure = createStructure(type, x, z);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateUI();
            
            showNotification(`${data.name} Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!`);
        }

        // ==================== Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª occupied ====================
        function isPositionOccupied(x, z) {
            for (const structure of gameState.structures) {
                const dx = structure.x - x;
                const dz = structure.z - z;
                const distance = Math.sqrt(dx * dx + dz * dz);
                
                if (distance < 10) {
                    return true;
                }
            }
            return false;
        }

        // ==================== Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø§Ø²ÛŒ ====================
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø´Ù…Ù†Ø§Ù†
            updateEnemies();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø±ØªØ§Ø¨Ù‡â€ŒÙ‡Ø§
            updateProjectiles();
            
            // Ø±Ù†Ø¯Ø± ØµØ­Ù†Ù‡
            renderer.render(scene, camera);
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø±ØªØ§Ø¨Ù‡â€ŒÙ‡Ø§ ====================
        function updateProjectiles() {
            for (let i = gameState.projectiles.length - 1; i >= 0; i--) {
                const projectile = gameState.projectiles[i];
                
                // Ø­Ø±Ú©Øª Ù¾Ø±ØªØ§Ø¨Ù‡
                projectile.mesh.position.x += projectile.vx;
                projectile.mesh.position.y += projectile.vy;
                projectile.mesh.position.z += projectile.vz;
                
                projectile.vy -= 0.01; // Ú¯Ø±Ø§Ù†Ø´
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø²Ù…ÛŒÙ†
                if (projectile.mesh.position.y <= 0) {
                    scene.remove(projectile.mesh);
                    gameState.projectiles.splice(i, 1);
                }
            }
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ====================
        function setupEventListeners() {
            // Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
            document.getElementById('startGameBtn').addEventListener('click', function() {
                document.getElementById('mainMenu').style.display = 'none';
                initThreeJS();
            });
            
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®Øª
            const buildButtons = document.querySelectorAll('.build-button');
            buildButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const buildingType = this.getAttribute('data-building');
                    buildStructure(buildingType);
                });
            });
            
            // Ø¯Ú©Ù…Ù‡ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø²Ù‡
            document.getElementById('upgradeStructureBtn').addEventListener('click', function() {
                if (gameState.selectedStructure) {
                    upgradeStructure(gameState.selectedStructure);
                }
            });
            
            // Ø¯Ú©Ù…Ù‡ Ø­Ù…Ù„Ù‡
            document.getElementById('attackBtn').addEventListener('click', function() {
                startEnemyAttack();
            });
            
            // Ø¯Ú©Ù…Ù‡ Ø¢Ù…ÙˆØ²Ø´ Ø³Ø±Ø¨Ø§Ø²
            document.getElementById('trainTroopsBtn').addEventListener('click', function() {
                if (gameState.resources.elixir >= 200) {
                    gameState.resources.elixir -= 200;
                    updateUI();
                    showNotification("ÛŒÚ© Ø³Ø±Ø¨Ø§Ø² Ø¬Ø¯ÛŒØ¯ Ø¢Ù…ÙˆØ²Ø´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯!");
                } else {
                    showNotification("Ø§Ú©Ø³ÛŒØ± Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ø³Ø±Ø¨Ø§Ø² Ù†Ø¯Ø§Ø±ÛŒØ¯!");
                }
            });
            
            // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø³Ø§Ø²Ù‡â€ŒÙ‡Ø§
            renderer.domElement.addEventListener('click', (event) => {
                const mouse = new THREE.Vector2();
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, camera);
                
                const intersects = raycaster.intersectObjects(scene.children);
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    
                    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø³Ø§Ø²Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡
                    for (const structure of gameState.structures) {
                        if (structure.mesh === clickedObject) {
                            selectStructure(structure);
                            return;
                        }
                    }
                    
                    // Ø§Ú¯Ø± Ø±ÙˆÛŒ Ø²Ù…ÛŒÙ† Ú©Ù„ÛŒÚ© Ø´Ø¯ØŒ Ù¾Ù†Ù„ Ø³Ø§Ø²Ù‡ Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†
                    hideStructurePanel();
                }
            });
            
            // ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù¾Ù†Ø¬Ø±Ù‡
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ ====================
        document.addEventListener('DOMContentLoaded', function() {
            let progress = 0;
            const loadingBar = document.getElementById('loadingBar');
            const loadingText = document.getElementById('loadingText');
            const loadingScreen = document.getElementById('loadingScreen');
            const mainMenu = document.getElementById('mainMenu');
            
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                    
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        mainMenu.style.display = 'flex';
                    }, 500);
                }
                
                loadingBar.style.width = `${progress}%`;
                
                if (progress < 30) {
                    loadingText.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ù‡ Ø¨Ø¹Ø¯ÛŒ...";
                } else if (progress < 60) {
                    loadingText.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ÙØªâ€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ§Ø¯...";
                } else if (progress < 90) {
                    loadingText.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ...";
                } else {
                    loadingText.textContent = "Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹!";
                }
            }, 200);
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
            setupEventListeners();
        });
    </script>
</body>
          </html>
