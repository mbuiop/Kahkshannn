<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø§Ø²ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Galactic Wars</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
    
    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    
    <!-- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø§Ø²ÛŒ - Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ -->
    <script src="m.js"></script>      <!-- Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø§ÙÛŒÚ© Ùˆ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ -->
    <script src="m1.js"></script>     <!-- Ø³ÛŒØ³ØªÙ… Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³ÛŒÙ†Ù…Ø§ÛŒÛŒ -->
    <script src="m2.js"></script>     <!-- Ø³ÛŒØ³ØªÙ… Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ø§Ø­Ù„ -->
    <script src="m3.js"></script>     <!-- Ø³ÛŒØ³ØªÙ… Ø¬Ù†Ú¯Ù†Ø¯Ù‡ Ùˆ ØªÛŒØ±Ø¨Ø§Ø± -->
    <script src="m5.js"></script>     <!-- Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ -->
    <script src="m6.js"></script>     <!-- Ø³ÛŒØ³ØªÙ… ÙÛŒØ²ÛŒÚ© Ùˆ collision -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            background: #000;
            overflow: hidden;
            touch-action: none;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: 100vw;
            height: 100vh;
            position: fixed;
        }
        
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* HUD Ùˆ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ */
        .hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .health-bar {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 300px;
            height: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .health-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff3300, #ffaa00, #00ff88);
            transition: width 0.3s;
        }
        
        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: white;
            text-shadow: 0 0 10px #00ccff;
            font-weight: bold;
        }
        
        .weapon-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            font-size: 18px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .level-display {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: #00ff88;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 20px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ */
        .touch-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 20;
        }
        
        .joystick {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            top: 25px;
            left: 25px;
        }
        
        .joystick-handle {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #00ccff, #0066ff);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.5);
        }
        
        .fire-button {
            position: absolute;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, #ff4444, #cc0000);
            border-radius: 50%;
            bottom: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            pointer-events: auto;
        }
        
        /* Ù…Ù†ÙˆÙ‡Ø§ Ùˆ ØµÙØ­Ø§Øª */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .main-menu {
            background: radial-gradient(circle, rgba(0, 20, 40, 0.9), rgba(0, 0, 0, 0.95));
        }
        
        .game-title {
            font-size: 4rem;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff8a00, #e52e71, #00aaff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(229, 46, 113, 0.5);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px rgba(255, 138, 0, 0.7)); }
            to { filter: drop-shadow(0 0 25px rgba(229, 46, 113, 0.7)); }
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 40px 0;
            align-items: center;
            width: 90%;
            max-width: 400px;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #00ccff, #0066ff);
            border: none;
            padding: 20px 30px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0, 204, 255, 0.5);
            transition: all 0.3s;
            width: 100%;
            text-align: center;
            pointer-events: auto;
        }
        
        .menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 7px 25px rgba(0, 204, 255, 0.7);
        }
        
        .menu-btn.start {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.5);
            font-size: 1.5rem;
            padding: 22px 30px;
        }
        
        .loading-screen {
            background: radial-gradient(circle, rgba(10, 30, 60, 0.95), rgba(0, 0, 0, 0.98));
        }
        
        .loading-text {
            font-size: 2rem;
            color: #00ccff;
            margin-top: 30px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading-bar-container {
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .loading-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00ccff, #0066ff);
            transition: width 0.3s;
            border-radius: 10px;
        }
        
        .error-message {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid rgba(255, 68, 68, 0.3);
            font-size: 14px;
            max-width: 500px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 3rem;
            }
            
            .menu-btn {
                padding: 18px 25px;
                font-size: 1.2rem;
            }
            
            .menu-btn.start {
                font-size: 1.3rem;
                padding: 20px 25px;
            }
            
            .health-bar {
                width: 200px;
            }
            
            .score-display {
                font-size: 20px;
            }
            
            .touch-controls {
                width: 130px;
                height: 130px;
            }
            
            .joystick {
                width: 80px;
                height: 80px;
            }
            
            .joystick-handle {
                width: 40px;
                height: 40px;
            }
            
            .fire-button {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .game-title {
                font-size: 2.5rem;
            }
            
            .menu-btn {
                padding: 16px 20px;
                font-size: 1.1rem;
            }
            
            .menu-btn.start {
                font-size: 1.2rem;
                padding: 18px 20px;
            }
            
            .health-bar {
                width: 150px;
                top: 10px;
                left: 10px;
            }
            
            .score-display {
                font-size: 18px;
                top: 10px;
                right: 10px;
            }
            
            .level-display {
                font-size: 16px;
                top: 10px;
            }
            
            .weapon-display {
                bottom: 10px;
                left: 10px;
                font-size: 16px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ -->
    <div id="gameContainer"></div>
    
    <!-- HUD Ùˆ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ -->
    <div class="hud">
        <div class="health-bar">
            <div class="health-fill" id="healthFill"></div>
        </div>
        <div class="score-display" id="scoreDisplay">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
        <div class="level-display" id="levelDisplay">Ù…Ø±Ø­Ù„Ù‡ 1</div>
        <div class="weapon-display" id="weaponDisplay">Ø³Ù„Ø§Ø­: Ù„ÛŒØ²Ø± Ù¾Ø§ÛŒÙ‡</div>
        
        <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ -->
        <div class="touch-controls" id="touchControls">
            <div class="joystick">
                <div class="joystick-handle"></div>
            </div>
            <div class="fire-button" id="fireButton">ğŸ”¥</div>
        </div>
    </div>
    
    <!-- ØµÙØ­Ø§Øª Ù…Ø®ØªÙ„Ù -->
    <div id="mainMenu" class="screen main-menu">
        <h1 class="game-title">ğŸš€ Galactic Wars</h1>
        <p style="font-size: 1.2rem; margin-bottom: 20px; color: #aaddff;">ØªØ¬Ø±Ø¨Ù‡ Ù†Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ Ø¯Ø± Ø§Ø¨Ø¹Ø§Ø¯ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª</p>
        
        <div class="menu-buttons">
            <button class="menu-btn start" onclick="startGame()">Ø´Ø±ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª</button>
            <button class="menu-btn" onclick="showSettings()">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            <button class="menu-btn" onclick="showCredits()">Ø³Ø§Ø²Ù†Ø¯Ú¯Ø§Ù†</button>
        </div>
        
        <div style="margin-top: 40px; color: #8899aa; font-size: 0.9rem;">
            <p>Ú¯Ø±Ø§ÙÛŒÚ© ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡ â€¢ ÙÛŒØ²ÛŒÚ© Ù¾ÛŒØ´Ø±ÙØªÙ‡ â€¢ Ú¯ÛŒÙ…â€ŒÙ¾Ù„ÛŒ Ø§Ú©Ø´Ù†</p>
        </div>
    </div>
    
    <div id="loadingScreen" class="screen loading-screen hidden">
        <div style="font-size: 4rem; margin-bottom: 20px;">ğŸŒŒ</div>
        <div class="loading-text" id="loadingText">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ù‡Ø§Ù†...</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div style="margin-top: 20px; color: #aaddff; font-size: 1rem;" id="loadingDetail">
            Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÙˆØªÙˆØ± Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ...
        </div>
        <div id="loadingErrors" class="error-message hidden"></div>
    </div>
    
    <div id="gameOverScreen" class="screen hidden">
        <h1 style="font-size: 3rem; color: #ff4444; margin-bottom: 20px;">Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯!</h1>
        <p style="font-size: 1.5rem; margin-bottom: 30px; color: #ffaaaa;">Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: <span id="finalScore">0</span></p>
        <p style="font-size: 1.2rem; margin-bottom: 40px; color: #aaddff;">Ø¢Ù…Ø§Ø¯Ù‡ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ù‡Ø³ØªÛŒØ¯ØŸ</p>
        <button class="menu-btn" onclick="restartGame()">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
        <button class="menu-btn" onclick="showMainMenu()" style="margin-top: 15px; background: linear-gradient(45deg, #888888, #555555);">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
    </div>
    
    <div id="levelCompleteScreen" class="screen hidden">
        <h1 style="font-size: 3rem; color: #00ff88; margin-bottom: 20px;">ØªØ¨Ø±ÛŒÚ©! ğŸ‰</h1>
        <p style="font-size: 1.5rem; margin-bottom: 30px; color: #aaffaa;">Ù…Ø±Ø­Ù„Ù‡ <span id="completedLevel">1</span> ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!</p>
        <p style="font-size: 1.2rem; margin-bottom: 40px; color: #aaddff;">Ø¢Ù…Ø§Ø¯Ù‡ Ú†Ø§Ù„Ø´ Ø¨Ø¹Ø¯ÛŒ Ù‡Ø³ØªÛŒØ¯ØŸ</p>
        <button class="menu-btn" onclick="nextLevel()">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</button>
    </div>

    <script>
        // =============================================
        // Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø²ÛŒ - Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ
        // =============================================

        const GameState = {
            MENU: 'menu',
            LOADING: 'loading',
            PLAYING: 'playing',
            PAUSED: 'paused',
            GAME_OVER: 'game_over',
            LEVEL_COMPLETE: 'level_complete'
        };
        
        let currentState = GameState.MENU;
        let gameInstance = null;
        let loadedFiles = {
            'm.js': false,
            'm1.js': false,
            'm2.js': false,
            'm3.js': false,
            'm5.js': false,
            'm6.js': false
        };

        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JS
        function loadScript(src, onLoad, onError) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    loadedFiles[src] = true;
                    if (onLoad) onLoad();
                    resolve(src);
                };
                script.onerror = () => {
                    if (onError) onError(src);
                    reject(new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${src}`));
                };
                document.head.appendChild(script);
            });
        }

        // ØªØ§Ø¨Ø¹ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        async function startGame() {
            setGameState(GameState.LOADING);
            
            try {
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
                await loadAllGameFiles();
                
                // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆÙÙ‚
                setTimeout(() => {
                    initializeGame();
                }, 500);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ:', error);
                showLoadingError('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ. Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø³ÛŒØ± ØµØ­ÛŒØ­ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ù†Ø¯.');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        async function loadAllGameFiles() {
            const files = [
                'm.js',  // Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø§ÙÛŒÚ©
                'm1.js', // Ø³ÛŒØ³ØªÙ… Ø¯ÙˆØ±Ø¨ÛŒÙ†  
                'm2.js', // Ø³ÛŒØ³ØªÙ… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
                'm3.js', // Ø³ÛŒØ³ØªÙ… Ø¬Ù†Ú¯Ù†Ø¯Ù‡
                'm5.js', // Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ
                'm6.js'  // Ø³ÛŒØ³ØªÙ… ÙÛŒØ²ÛŒÚ©
            ];
            
            let progress = 0;
            const totalFiles = files.length;
            
            for (const file of files) {
                try {
                    updateLoadingScreen(progress, `Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${file}...`);
                    await loadScript(file, 
                        () => {
                            console.log(`âœ… ${file} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`);
                        },
                        (failedFile) => {
                            console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${failedFile}`);
                        }
                    );
                    progress += (100 / totalFiles);
                } catch (error) {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${file}: ${error.message}`);
                }
            }
            
            updateLoadingScreen(100, 'Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØª!');
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        function updateLoadingScreen(progress, detail = '') {
            document.getElementById('loadingBar').style.width = `${progress}%`;
            
            const loadingText = document.getElementById('loadingText');
            const loadingDetail = document.getElementById('loadingDetail');
            
            if (progress < 20) {
                loadingText.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ù‡Ø§Ù†...";
            } else if (progress < 40) {
                loadingText.textContent = "Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù‡Ú©Ø´Ø§Ù†...";
            } else if (progress < 60) {
                loadingText.textContent = "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¬Ù†Ú¯Ù†Ø¯Ù‡...";
            } else if (progress < 80) {
                loadingText.textContent = "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø´Ù…Ù†Ø§Ù†...";
            } else {
                loadingText.textContent = "Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØª!";
            }
            
            if (detail) {
                loadingDetail.textContent = detail;
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        function showLoadingError(message) {
            const errorDiv = document.getElementById('loadingErrors');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            const retryButton = document.createElement('button');
            retryButton.textContent = 'ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯';
            retryButton.className = 'menu-btn';
            retryButton.style.marginTop = '15px';
            retryButton.onclick = startGame;
            
            errorDiv.appendChild(retryButton);
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨ÙˆØ¯Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
        function checkRequiredClasses() {
            const requiredClasses = [
                'GraphicsSystem',
                'CinematicCamera', 
                'AnimationSystem',
                'FighterSystem',
                'GameEngine',
                'PhysicsSystem'
            ];
            
            const missingClasses = [];
            
            for (const className of requiredClasses) {
                if (typeof window[className] === 'undefined') {
                    missingClasses.push(className);
                }
            }
            
            return missingClasses;
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        function initializeGame() {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨ÙˆØ¯Ù† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
            const missingClasses = checkRequiredClasses();
            if (missingClasses.length > 0) {
                showLoadingError(`Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯: ${missingClasses.join(', ')}`);
                return;
            }
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾
            if (window.innerWidth > 768) {
                document.getElementById('touchControls').style.display = 'none';
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø§Ø²ÛŒ
            try {
                gameInstance = new window.GameEngine('gameContainer');
                gameInstance.start();
                setGameState(GameState.PLAYING);
                
                console.log('âœ… Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯');
                console.log('ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡:', loadedFiles);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ:', error);
                showLoadingError(`Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ: ${error.message}`);
            }
        }
        
        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        function setGameState(newState) {
            currentState = newState;
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ØµÙØ­Ø§Øª
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù…Ù†Ø§Ø³Ø¨
            switch(newState) {
                case GameState.MENU:
                    document.getElementById('mainMenu').classList.remove('hidden');
                    break;
                case GameState.LOADING:
                    document.getElementById('loadingScreen').classList.remove('hidden');
                    break;
                case GameState.PLAYING:
                    // Ù‡ÛŒÚ† ØµÙØ­Ù‡â€ŒØ§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ (HUD ÙØ¹Ø§Ù„ Ø§Ø³Øª)
                    break;
                case GameState.GAME_OVER:
                    document.getElementById('gameOverScreen').classList.remove('hidden');
                    break;
                case GameState.LEVEL_COMPLETE:
                    document.getElementById('levelCompleteScreen').classList.remove('hidden');
                    break;
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ù…Ù†Ùˆ
        function showSettings() {
            alert("Ù…Ù†ÙˆÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª - Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯");
        }
        
        function showCredits() {
            const credits = `
Ø³Ø§Ø²Ù†Ø¯Ú¯Ø§Ù† Ø¨Ø§Ø²ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ:

â€¢ Ø³ÛŒØ³ØªÙ… Ú¯Ø±Ø§ÙÛŒÚ©: m.js
â€¢ Ø³ÛŒØ³ØªÙ… Ø¯ÙˆØ±Ø¨ÛŒÙ†: m1.js  
â€¢ Ø³ÛŒØ³ØªÙ… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†: m2.js
â€¢ Ø³ÛŒØ³ØªÙ… Ø¬Ù†Ú¯Ù†Ø¯Ù‡: m3.js
â€¢ Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ: m5.js
â€¢ Ø³ÛŒØ³ØªÙ… ÙÛŒØ²ÛŒÚ©: m6.js

ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒâ€ŒÙ‡Ø§:
â€¢ Three.js - Ú¯Ø±Ø§ÙÛŒÚ© Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ
â€¢ GSAP - Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
â€¢ Howler.js - Ø³ÛŒØ³ØªÙ… ØµÙˆØªÛŒ
            `;
            alert(credits);
        }
        
        function restartGame() {
            if (gameInstance) {
                gameInstance.destroy();
                gameInstance = null;
            }
            startGame();
        }
        
        function showMainMenu() {
            if (gameInstance) {
                gameInstance.destroy();
                gameInstance = null;
            }
            setGameState(GameState.MENU);
        }
        
        function nextLevel() {
            if (gameInstance && gameInstance.nextLevel) {
                gameInstance.nextLevel();
                setGameState(GameState.PLAYING);
            }
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ HUD
        function updateHUD(health, score, level, weapon) {
            document.getElementById('healthFill').style.width = `${health}%`;
            document.getElementById('scoreDisplay').textContent = `Ø§Ù…ØªÛŒØ§Ø²: ${score}`;
            document.getElementById('levelDisplay').textContent = `Ù…Ø±Ø­Ù„Ù‡ ${level}`;
            document.getElementById('weaponDisplay').textContent = `Ø³Ù„Ø§Ø­: ${weapon}`;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡
        function showGameOver(finalScore) {
            document.getElementById('finalScore').textContent = finalScore;
            setGameState(GameState.GAME_OVER);
        }
        
        // Ù†Ù…Ø§ÛŒØ´ ØªÚ©Ù…ÛŒÙ„ Ù…Ø±Ø­Ù„Ù‡
        function showLevelComplete(level) {
            document.getElementById('completedLevel').textContent = level;
            setGameState(GameState.LEVEL_COMPLETE);
        }
        
        // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ
        function setupTouchControls() {
            const joystick = document.querySelector('.joystick');
            const joystickHandle = document.querySelector('.joystick-handle');
            const fireButton = document.getElementById('fireButton');
            
            let isTouching = false;
            let touchId = null;
            let joystickBaseX = 0;
            let joystickBaseY = 0;
            const joystickRadius = 40;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ø§ÛŒÙ‡ Ø¬ÙˆÛŒØ³ØªÛŒÚ©
            const updateJoystickBase = () => {
                const rect = joystick.getBoundingClientRect();
                joystickBaseX = rect.left + rect.width / 2;
                joystickBaseY = rect.top + rect.height / 2;
            };
            
            window.addEventListener('resize', updateJoystickBase);
            updateJoystickBase();
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ
            joystick.addEventListener('touchstart', (e) => {
                if (isTouching) return;
                
                e.preventDefault();
                isTouching = true;
                touchId = e.changedTouches[0].identifier;
                
                if (gameInstance && gameInstance.systems && gameInstance.systems.input) {
                    gameInstance.systems.input.setJoystickActive(true);
                }
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!isTouching) return;
                
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù„Ù…Ø³ÛŒ Ú©Ù‡ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬ÙˆÛŒØ³ØªÛŒÚ© Ø§Ø³Øª
                let touch = null;
                for (let i = 0; i < e.touches.length; i++) {
                    if (e.touches[i].identifier === touchId) {
                        touch = e.touches[i];
                        break;
                    }
                }
                
                if (!touch) return;
                
                e.preventDefault();
                
                const deltaX = touch.clientX - joystickBaseX;
                const deltaY = touch.clientY - joystickBaseY;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù…Ø±Ú©Ø²
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const angle = Math.atan2(deltaY, deltaX);
                
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø´Ø¹Ø§Ø¹ Ø¬ÙˆÛŒØ³ØªÛŒÚ©
                const limitedDistance = Math.min(distance, joystickRadius);
                
                // Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯ Ù‡Ù†Ø¯Ù„
                const newX = limitedDistance * Math.cos(angle);
                const newY = limitedDistance * Math.sin(angle);
                
                joystickHandle.style.transform = `translate(${newX}px, ${newY}px)`;
                
                // Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ
                if (gameInstance && gameInstance.systems && gameInstance.systems.input) {
                    const normalizedX = limitedDistance / joystickRadius * Math.cos(angle);
                    const normalizedY = limitedDistance / joystickRadius * Math.sin(angle);
                    gameInstance.systems.input.setJoystickDirection(normalizedX, normalizedY);
                }
            });
            
            document.addEventListener('touchend', (e) => {
                if (!isTouching) return;
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù„Ù…Ø³ÛŒ Ú©Ù‡ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¬ÙˆÛŒØ³ØªÛŒÚ© Ø§Ø³Øª
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === touchId) {
                        isTouching = false;
                        touchId = null;
                        
                        joystickHandle.style.transform = 'translate(0, 0)';
                        
                        if (gameInstance && gameInstance.systems && gameInstance.systems.input) {
                            gameInstance.systems.input.setJoystickActive(false);
                        }
                        break;
                    }
                }
            });
            
            // Ø¯Ú©Ù…Ù‡ Ø´Ù„ÛŒÚ©
            fireButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                
                if (gameInstance && gameInstance.systems && gameInstance.systems.input) {
                    gameInstance.systems.input.setFiring(true);
                }
                
                fireButton.style.transform = 'scale(0.9)';
                fireButton.style.background = 'radial-gradient(circle, #ff6666, #aa0000)';
            });
            
            fireButton.addEventListener('touchend', (e) => {
                e.preventDefault();
                
                if (gameInstance && gameInstance.systems && gameInstance.systems.input) {
                    gameInstance.systems.input.setFiring(false);
                }
                
                fireButton.style.transform = 'scale(1)';
                fireButton.style.background = 'radial-gradient(circle, #ff4444, #cc0000)';
            });
        }
        
        // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÛŒØ¨ÙˆØ±Ø¯
        function setupKeyboardControls() {
            document.addEventListener('keydown', (e) => {
                if (currentState !== GameState.PLAYING || !gameInstance || !gameInstance.systems || !gameInstance.systems.input) return;
                
                switch(e.key) {
                    case ' ':
                    case 'Spacebar':
                        e.preventDefault();
                        gameInstance.systems.input.setFiring(true);
                        break;
                    case 'Escape':
                        // Ù…Ú©Ø« Ø¨Ø§Ø²ÛŒ - Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´ÙˆØ¯
                        break;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (currentState !== GameState.PLAYING || !gameInstance || !gameInstance.systems || !gameInstance.systems.input) return;
                
                switch(e.key) {
                    case ' ':
                    case 'Spacebar':
                        e.preventDefault();
                        gameInstance.systems.input.setFiring(false);
                        break;
                }
            });
        }
        
        // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ³
        function setupMouseControls() {
            document.addEventListener('mousedown', (e) => {
                if (currentState !== GameState.PLAYING || !gameInstance || !gameInstance.systems || !gameInstance.systems.input) return;
                
                if (e.button === 0) { // Ú©Ù„ÛŒÚ© Ú†Ù¾
                    gameInstance.systems.input.setFiring(true);
                }
            });
            
            document.addEventListener('mouseup', (e) => {
                if (currentState !== GameState.PLAYING || !gameInstance || !gameInstance.systems || !gameInstance.systems.input) return;
                
                if (e.button === 0) { // Ú©Ù„ÛŒÚ© Ú†Ù¾
                    gameInstance.systems.input.setFiring(false);
                }
            });
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ ØªÙˆØ³Ø· Ù…ÙˆØªÙˆØ± Ø¨Ø§Ø²ÛŒ
        window.GameUI = {
            updateHUD,
            showGameOver,
            showLevelComplete,
            setGameState
        };

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        window.addEventListener('load', () => {
            setupTouchControls();
            setupKeyboardControls();
            setupMouseControls();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
            setGameState(GameState.MENU);
            
            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
            console.log('ğŸš€ Ø¨Ø§Ø²ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
            console.log('ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:', Object.keys(loadedFiles));
        });
        
        // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù¾Ù†Ø¬Ø±Ù‡
        window.addEventListener('resize', () => {
            if (gameInstance && gameInstance.onResize) {
                gameInstance.onResize();
            }
        });
    </script>
</body>
  </html>
